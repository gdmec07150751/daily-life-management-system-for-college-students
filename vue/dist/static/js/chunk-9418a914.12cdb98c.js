(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9418a914"],{"0481":function(e,t,n){"use strict";var r=n("23e7"),a=n("a2bf"),i=n("7b0b"),l=n("07fa"),o=n("5926"),s=n("65f0");r({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=i(this),n=l(t),r=s(t,0);return r.length=a(r,t,t,n,0,void 0===e?1:o(e)),r}})},"07ac":function(e,t,n){var r=n("23e7"),a=n("6f53").values;r({target:"Object",stat:!0},{values:function(e){return a(e)}})},3482:function(e,t,n){var r=n("087d"),a=n("5c69"),i=n("4359"),l=n("6747");function o(){var e=arguments.length;if(!e)return[];var t=Array(e-1),n=arguments[0],o=e;while(o--)t[o-1]=arguments[o];return r(l(n)?i(n):[n],a(t,1))}e.exports=o},4069:function(e,t,n){var r=n("44d2");r("flat")},"466d":function(e,t,n){"use strict";var r=n("c65b"),a=n("d784"),i=n("825a"),l=n("50c4"),o=n("577e"),s=n("1d80"),u=n("dc4a"),c=n("8aa5"),d=n("14c3");a("match",(function(e,t,n){return[function(t){var n=s(this),a=void 0==t?void 0:u(t,e);return a?r(a,t,n):new RegExp(t)[e](o(n))},function(e){var r=i(this),a=o(e),s=n(t,r,a);if(s.done)return s.value;if(!r.global)return d(r,a);var u=r.unicode;r.lastIndex=0;var p,f=[],h=0;while(null!==(p=d(r,a))){var m=o(p[0]);f[h]=m,""===m&&(r.lastIndex=c(a,l(r.lastIndex),u)),h++}return 0===h?null:f}]}))},"4b51":function(e,t,n){"use strict";var r=n("5530"),a=n("3482"),i=n.n(a),l=n("51f5"),o=n.n(l),s=n("ded5"),u=n.n(s),c=n("13ea"),d=n.n(c);n("ac1f"),n("1276"),n("d81d"),n("d3b7"),n("159b"),n("b64b"),n("0481"),n("4069"),n("07ac"),n("b0c0");t["a"]={methods:{splitPerms:function(e){if(e){var t=e.split(",");if(t&&t.length>0)return t}return[]},joinPerms:function(e){if(d()(e))return"";var t=e.map((function(e){return u()(e,":")}));return u()(t,",")},flatPerms:function(e){var t=this,n=[];return Object.keys(e).forEach((function(r){var a=e[r]._permission;if(a)n=i()(n,[Object.values(a)].flat());else{var l=t.flatPerms(e[r]);l&&l.length>0&&(n=i()(n,l))}})),n},filterPermToCascader:function(e,t,n){var r=t[e],a=o()(n,(function(e){return e.label===r}));if(a>=0)this.filterPermToCascader(e+1,t,n[a].children);else{var i=e===t.length-1,l={value:r,label:r,children:i?null:[]};n&&n.push(l),i||this.filterPermToCascader(e+1,t,n[n.length-1].children)}},filterMenuToTable:function(e,t){var n=this,a=[];return e.forEach((function(i){var l;if(t||i.parentId||1!==i.type)if(t||i.parentId||0!==i.type)if(t&&t.id===i.parentId&&1===i.type){var o=n.filterMenuToTable(e,i);l=Object(r["a"])({},i),l.children=o}else if(t&&t.id===i.parentId&&0===i.type){var s=n.filterMenuToTable(e,i);l=Object(r["a"])({},i),l.children=s}else t&&t.id===i.parentId&&2===i.type&&(l=Object(r["a"])({},i));else{var u=n.filterMenuToTable(e,i);l=Object(r["a"])({},i),l.children=u}else{var c=n.filterMenuToTable(e,i);l=Object(r["a"])({},i),l.children=c}l&&(l.pid=i.id,a.push(l))})),a},filterMenuToTree:function(e,t){var n=this,r=[];return e.forEach((function(a){var i;if(2!==a.type){if(t||a.parentId||1!==a.type)if(t||a.parentId||0!==a.type){if(t&&t.id===a.parentId&&1===a.type)i={label:a.name};else if(t&&t.id===a.parentId&&0===a.type){var l=n.filterMenuToTree(e,a);i={label:a.name},i.children=l}}else{var o=n.filterMenuToTree(e,a);i={label:a.name},i.children=o}else i={label:a.name};i&&(i.id=a.id,r.push(i))}})),r},filterMenuHasPermsToTree:function(e,t){var n=this,r=[];return e.forEach((function(a){var i;if(t||a.parentId||1!==a.type)if(t||a.parentId||0!==a.type)if(t&&t.id===a.parentId&&1===a.type){var l=n.filterMenuHasPermsToTree(e,a);i={label:a.name},i.children=l}else if(t&&t.id===a.parentId&&0===a.type){var o=n.filterMenuHasPermsToTree(e,a);i={label:a.name},i.children=o}else t&&t.id===a.parentId&&2===a.type&&(i={label:a.name});else{var s=n.filterMenuHasPermsToTree(e,a);i={label:a.name},i.children=s}else{var u=n.filterMenuHasPermsToTree(e,a);i={label:a.name},i.children=u}i&&(i.id=a.id,r.push(i))})),r},filterDeptToTree:function(e,t){var n=this,r=[];return e.forEach((function(a){var i;if(t||a.parentId){if(t&&t.id===a.parentId){var l=n.filterDeptToTree(e,a);i={label:a.name},i.children=l}}else{var o=n.filterDeptToTree(e,a);i={label:a.name},i.children=o}i&&(i.id=a.id,r.push(i))})),r}}}},"501e":function(e,t,n){var r=n("3729"),a=n("1310"),i="[object Number]";function l(e){return"number"==typeof e||a(e)&&r(e)==i}e.exports=l},"6f53":function(e,t,n){var r=n("83ab"),a=n("e330"),i=n("df75"),l=n("fc6a"),o=n("d1e7").f,s=a(o),u=a([].push),c=function(e){return function(t){var n,a=l(t),o=i(a),c=o.length,d=0,p=[];while(c>d)n=o[d++],r&&!s(a,n)||u(p,e?[n,a[n]]:a[n]);return p}};e.exports={entries:c(!0),values:c(!1)}},"811f":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"sys-perm-container"},[n("table-layout",[n("s-table",{ref:"menuTable",attrs:{"data-request":e.getMenuList,"row-key":"id",border:"","tree-props":{children:"children",hasChildren:"hasChildren"}},on:{"row-click":e.handleRowClick},scopedSlots:e._u([{key:"prepend",fn:function(){return[n("el-button",{attrs:{size:"mini",type:"primary",disabled:!e.$auth("sys.menu.add")},on:{click:e.handleAdd}},[e._v("新增")])]},proxy:!0}])},[n("el-table-column",{attrs:{prop:"name",label:"名称",width:"240"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{staticStyle:{"margin-right":"16px"}},[e._v(e._s(t.row.name))]),t.row.isShow||2===t.row.type?e._e():n("el-tag",{attrs:{type:"danger",effect:"dark",size:"small"}},[e._v("隐藏")])]}}])}),n("el-table-column",{attrs:{prop:"icon",label:"图标",width:"60",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.icon?n("svg-icon",{attrs:{"icon-class":t.row.icon}}):e._e()]}}])}),n("el-table-column",{attrs:{prop:"type",label:"类型",width:"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-tag",{attrs:{size:"small",effect:"dark"}},[e._v(e._s(e.getMenuType(t.row.type)))])]}}])}),n("el-table-column",{attrs:{prop:"router",label:"节点路由",align:"center",width:"240"}}),n("el-table-column",{attrs:{prop:"keepalive",label:"路由缓存",width:"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.keepalive&&1===t.row.type?n("i",{staticClass:"el-icon-check"}):e._e()]}}])}),n("el-table-column",{attrs:{prop:"viewPath",label:"文件路径",align:"center",width:"280"}}),n("el-table-column",{attrs:{prop:"perms",label:"权限","header-align":"center",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(e.splitPerms(t.row.perms),(function(t){return n("el-tag",{key:t,style:{"margin-right":"3px"},attrs:{effect:"dark",size:"mini"}},[e._v(e._s(t))])}))}}])}),n("el-table-column",{attrs:{prop:"orderNum",label:"排序号",width:"80",align:"center"}}),n("el-table-column",{attrs:{prop:"updatedAt",label:"更新时间",width:"180",align:"center"}}),n("el-table-column",{attrs:{label:"操作",width:"150",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{disabled:!e.$auth("sys.menu.update"),size:"mini",type:"text"},on:{click:function(n){return n.stopPropagation(),e.handleEdit(t.row)}}},[e._v("编辑")]),n("warning-confirm-button",{attrs:{closed:e.handleRefresh,disabled:!e.$auth("sys.menu.delete")},on:{confirm:function(n){e.handleDelete(t.row,n)}}},[e._v("删除")])]}}])})],1)],1),n("menu-form-dialog",{ref:"menuDialog",on:{"save-success":e.handleRefresh}})],1)},a=[],i=n("1da1"),l=(n("96cf"),n("ab09")),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("form-dialog",{ref:"formDialog",scopedSlots:e._u([{key:"slot-type",fn:function(t){var r=t.scope;return[n("el-radio-group",{on:{change:e.handleMenuTypeChange},model:{value:r.type,callback:function(t){e.$set(r,"type",t)},expression:"scope.type"}},[n("el-radio",{attrs:{label:0}},[e._v("目录")]),n("el-radio",{attrs:{label:1}},[e._v("菜单")]),n("el-radio",{attrs:{label:2}},[e._v("权限")])],1)]}},{key:"slot-perms",fn:function(t){var r=t.scope;return[n("permission-cascader",{model:{value:r.perms,callback:function(t){e.$set(r,"perms",t)},expression:"scope.perms"}})]}},{key:"slot-parent-node-name",fn:function(t){var r=t.scope;return[n("el-popover",{attrs:{placement:"bottom-start",width:"500"}},[n("el-tree",{style:{"max-height":"400px","overflow-y":"auto"},attrs:{"node-key":"id","expand-on-click-node":!1,data:e.menus,props:{children:"children",label:"label"}},on:{"node-click":function(t){e.handleMenuNodeClick(t.id,t.label,r)}}}),n("el-input",{attrs:{slot:"reference",placeholder:"请选择上级节点",readonly:""},slot:"reference",model:{value:r.parentNode.name,callback:function(t){e.$set(r.parentNode,"name",t)},expression:"scope.parentNode.name"}})],1)]}},{key:"slot-icon",fn:function(t){var r=t.scope;return[n("menu-icon-selector",{model:{value:r.icon,callback:function(t){e.$set(r,"icon",t)},expression:"scope.icon"}})]}},{key:"slot-view-path",fn:function(t){var r=t.scope;return[n("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择文件路径"},model:{value:r.viewPath,callback:function(t){e.$set(r,"viewPath",t)},expression:"scope.viewPath"}},e._l(e.getViewFiles(),(function(e){return n("el-option",{key:e,attrs:{label:e,value:e}})})),1)]}}])})},s=[],u=n("501e"),c=n.n(u),d=(n("b0c0"),n("b64b"),n("d9e2"),n("a18c")),p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-cascader",{staticStyle:{width:"100%"},attrs:{value:e.permsArr,options:e.options,props:e.props,separator:":",clearable:""},on:{change:e.handleChange}})},f=[],h=(n("d81d"),n("ac1f"),n("1276"),n("d3b7"),n("159b"),n("4b51")),m={name:"PermissionCascader",mixins:[h["a"]],props:["value"],data:function(){return{props:{multiple:!0},options:[]}},computed:{permsArr:function(){var e=this.splitPerms(this.value).map((function(e){return e.split(":")}));return e}},created:function(){var e=this,t=[];this.flatPerms(this.$api).forEach((function(n){var r=n.split(":");e.filterPermToCascader(0,r,t)})),this.options=t},methods:{handleChange:function(e){var t=this.joinPerms(e);this.$emit("input",t)}}},v=m,b=n("2877"),g=Object(b["a"])(v,p,f,!1,null,null,null),y=g.exports,w=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-select",{staticStyle:{width:"100%"},attrs:{value:e.value,placeholder:"请选择图标"},on:{change:e.handleSelectChange}},e._l(e.svgIcons,(function(t){return n("el-option",{key:t,attrs:{label:t,value:t}},[n("span",{staticStyle:{float:"left","font-size":"16px",color:"#444444"}},[n("svg-icon",{attrs:{"icon-class":t,"class-name":"select-icon"}})],1),n("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t))])])})),1)},T=[],k=(n("ddb0"),n("466d"),n("51ff")),x=function(e){return e.keys()},_=/\.\/(.*)\.svg/,I=x(k).map((function(e){return e.match(_)[1]})),S={name:"MenuIconSelector",props:{value:{type:String,default:""}},data:function(){return{svgIcons:I}},methods:{handleSelectChange:function(e){this.$emit("input",e)}}},$=S,M=Object(b["a"])($,w,T,!1,null,null,null),P=M.exports,C={name:"SystemPermissionMenuFormDialog",components:{PermissionCascader:y,MenuIconSelector:P},mixins:[h["a"]],data:function(){return{menuId:-1,menus:[]}},methods:{handleMenuTypeChange:function(){this.$refs.formDialog&&this.$refs.formDialog.clearValidate()},handleMenuNodeClick:function(e,t,n){n.parentNode.id=e,n.parentNode.name=t},getViewFiles:function(){return Object.keys(d["a"])},handleOpen:function(e,t){var n=t.showLoading,r=t.hideLoading,a=t.close,i=t.rebind;-1!==this.menuId&&(n(),this.$api.sys.menu.info({menuId:this.menuId}).then((function(e){var t=e.data,n=t.menu,a=t.parentMenu;n.parentNode={id:a?n.parentId:-1,name:a?a.name:"一级菜单"},i(n),r()})).catch((function(){a()})))},handleSubmit:function(e,t){var n=this,r=t.close,a=t.done,i=e.parentNode;delete e.parentNode,e.parentId=i.id;var l=null;-1===this.menuId?l=this.$api.sys.menu.add(e):(e.menuId=this.menuId,l=this.$api.sys.menu.update(e)),l.then((function(e){n.$emit("save-success"),r()})).catch((function(){a()}))},open:function(e,t){if(t&&!c()(t))throw new Error("menuId is not invalid");if(!e)throw new Error("menu must be not null");this.menuId=null!==t&&void 0!==t?t:-1,this.menus=e,this.$refs.formDialog.open({title:"编辑菜单",on:{open:this.handleOpen,submit:this.handleSubmit},items:[{label:"菜单类型",prop:"type",value:0,rules:{required:!0,message:"请选择菜单类型",trigger:"blur"},component:"slot-type"},{label:"节点名称",prop:"name",value:"",rules:{required:!0,message:"请输入正确的节点名称",trigger:"blur"},component:{name:"el-input",attrs:{placeholder:"请输入节点名称"}}},{label:"上级节点",prop:"parentNode",value:{id:void 0,name:""},rules:{required:!0,trigger:"blur",validator:function(e,t,n){t.id&&c()(t.id)?n():n(new Error("请选择上级节点"))}},component:"slot-parent-node-name"},{label:"节点路由",prop:"router",value:"",hidden:function(e){var t=e.scope;return 2===t.type},rules:{required:!0,message:"请输入正确的节点路由",trigger:"blur"},component:{name:"el-input",attrs:{placeholder:"请输入节点路由"}}},{label:"权限",prop:"perms",value:"",hidden:function(e){var t=e.scope;return 2!==t.type},rules:{required:!0,message:"请选择权限",trigger:"blur"},component:"slot-perms"},{label:"节点图标",prop:"icon",value:"",hidden:function(e){var t=e.scope;return 2===t.type},component:"slot-icon"},{label:"节点路径",prop:"viewPath",value:"",hidden:function(e){var t=e.scope;return 1!==t.type},component:"slot-view-path"},{label:"是否缓存",prop:"keepalive",value:!0,hidden:function(e){var t=e.scope;return 1!==t.type},component:{name:"el-switch"}},{label:"是否显示",prop:"isShow",value:!0,hidden:function(e){var t=e.scope;return 2===t.type},component:{name:"el-switch"}},{label:"排序号",prop:"orderNum",value:255,component:{name:"el-input-number",style:{width:"100%"},props:{"controls-position":"right",min:0}}}]})}}},j=C,E=Object(b["a"])(j,o,s,!1,null,null,null),O=E.exports,D=n("fe2b"),N=n("fbbc"),B={name:"SystemPermissionMenu",components:{STable:l["a"],MenuFormDialog:O,TableLayout:N["a"],WarningConfirmButton:D["a"]},mixins:[h["a"]],data:function(){return{menutree:[]}},methods:{getMenuList:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$api.sys.menu.list();case 2:return n=t.sent,r=n.data,e.menutree&&e.menutree.length>0&&(e.menutree=[]),a={id:-1,label:"一级菜单"},a.children=e.filterMenuToTree(r,null),e.menutree.push(a),t.abrupt("return",{list:e.filterMenuToTable(r,null)});case 9:case"end":return t.stop()}}),t)})))()},getMenuType:function(e){switch(e){case 0:return"目录";case 1:return"菜单";case 2:return"权限"}},handleRowClick:function(e){this.$refs.menuTable.getTable().toggleRowExpansion(e)},handleRefresh:function(){this.$refs.menuTable.refresh()},handleAdd:function(){this.$refs.menuDialog.open(this.menutree)},handleEdit:function(e){this.$refs.menuDialog.open(this.menutree,e.id)},handleDelete:function(e,t){var n=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var a,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=t.close,i=t.done,r.prev=1,r.next=4,n.$api.sys.menu.delete({menuId:e.id});case 4:a(),r.next=10;break;case 7:r.prev=7,r.t0=r["catch"](1),i();case 10:case"end":return r.stop()}}),r,null,[[1,7]])})))()}}},R=B,z=Object(b["a"])(R,r,a,!1,null,null,null);t["default"]=z.exports},a2bf:function(e,t,n){"use strict";var r=n("da84"),a=n("e8b5"),i=n("07fa"),l=n("0366"),o=r.TypeError,s=function(e,t,n,r,u,c,d,p){var f,h,m=u,v=0,b=!!d&&l(d,p);while(v<r){if(v in n){if(f=b?b(n[v],v,t):n[v],c>0&&a(f))h=i(f),m=s(e,t,f,h,m,c-1)-1;else{if(m>=9007199254740991)throw o("Exceed the acceptable array length");e[m]=f}m++}v++}return m};e.exports=s},ded5:function(e,t){var n=Array.prototype,r=n.join;function a(e,t){return null==e?"":r.call(e,t)}e.exports=a},fe2b:function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-button",{attrs:{size:e.size,type:e.buttonType,disabled:e.disabled},on:{click:function(t){return t.stopPropagation(),e._handleClick.apply(null,arguments)}}},[e._t("default")],2)},a=[],i={name:"WarningConfirmButton",props:{content:{type:String,default:"此操作无法恢复，是否继续？"},title:{type:String,default:"警告"},confirmButtonText:{type:String,default:"确定"},cancelButtonText:{type:String,default:"取消"},iconType:{type:String,default:"warning",validator:function(e){return-1!==["success","info","warning","error"].indexOf(e)}},size:{type:String,default:"mini"},buttonType:{type:String,default:"text"},disabled:{type:Boolean,default:!1},closed:{type:Function,default:function(){return function(){}}},cancel:{type:Function,default:function(){return function(){}}}},data:function(){return{loading:!1}},methods:{_handleClick:function(){var e=this;this.$confirm(this.content,this.title,{confirmButtonText:this.confirmButtonText,cancelButtonText:this.cancelButtonText,type:this.iconType,beforeClose:function(t,n,r){"confirm"===t?(n.confirmButtonLoading=!0,e.$emit("confirm",{close:function(){n.confirmButtonLoading=!1,r()},done:function(){n.confirmButtonLoading=!1}})):(n.confirmButtonLoading=!1,r())}}).then((function(t){e.closed()})).catch((function(t){e.cancel()}))}}},l=i,o=n("2877"),s=Object(o["a"])(l,r,a,!1,null,null,null);t["a"]=s.exports}}]);