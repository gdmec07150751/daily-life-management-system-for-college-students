(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-dedea802"],{"0849":function(e,t,n){},"1e38":function(e,t,n){},"4ea7":function(e,t,n){"use strict";n("0849")},"501e":function(e,t,n){var a=n("3729"),r=n("1310"),o="[object Number]";function s(e){return"number"==typeof e||r(e)&&a(e)==o}e.exports=s},5416:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"sys-schedule-task-container"},[n("table-layout",[n("s-table",{ref:"taskTable",attrs:{"data-request":e.getTaskList,"show-pagination":"","row-key":"id",border:!1},scopedSlots:e._u([{key:"prepend",fn:function(){return[n("el-button",{attrs:{size:"mini",type:"primary",disabled:!e.$auth("sys.task.add")},on:{click:e.handleAdd}},[e._v("新增")])]},proxy:!0}])},[n("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-form",{staticClass:"task-detail-table-expand",attrs:{"label-position":"left"}},[n("el-form-item",{attrs:{label:"任务编号"}},[n("span",[e._v("# "+e._s(t.row.id))])]),n("el-form-item",{attrs:{label:"执行次数"}},[n("span",[e._v(e._s(t.row.limit>0?"仅 "+t.row.limit+" 次":"无次数限制"))])]),1===t.row.type?n("el-form-item",{attrs:{label:"执行间隔"}},[n("span",[e._v("每 "+e._s(t.row.every)+" 毫秒执行一次")])]):n("el-form-item",{attrs:{label:"Cron表达式"}},[n("el-tooltip",{attrs:{content:"秒 分 小时 日期 月份 星期 年(可选)"}},[n("span",[e._v(e._s(t.row.cron))])])],1),0===t.row.type?n("el-form-item",{attrs:{label:"执行时间段"}},[n("span",[e._v(e._s(e.parseExecTime(t.row)))])]):e._e(),n("el-form-item",{attrs:{label:"执行操作"}},[n("warning-confirm-button",{attrs:{closed:e.handleRefresh,content:"确认手动执行一次该任务吗",disabled:!e.$auth("sys.task.once")},on:{confirm:function(n){e.handleOnce(t.row,n)}}},[n("i",{staticClass:"el-icon-magic-stick op-m-5"}),e._v("仅一次")]),n("warning-confirm-button",{attrs:{closed:e.handleRefresh,content:"确认运行该任务吗",disabled:!e.$auth("sys.task.start")||!(0===t.row.status)},on:{confirm:function(n){e.handleStart(t.row,n)}}},[n("i",{staticClass:"el-icon-caret-right op-m-5"}),e._v("运行")]),n("warning-confirm-button",{attrs:{closed:e.handleRefresh,content:"确认停止该任务吗",disabled:!e.$auth("sys.task.stop")||!(1===t.row.status)},on:{confirm:function(n){e.handleStop(t.row,n)}}},[n("i",{staticClass:"el-icon-switch-button op-m-5"}),e._v("停止")])],1)],1)]}}])}),n("el-table-column",{attrs:{prop:"name","show-overflow-tooltip":"",label:"任务名称",align:"center",width:"240"}}),n("el-table-column",{attrs:{prop:"status",label:"状态",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{staticClass:"badge-status"},[n("span",{class:{dot:!0,processing:1===t.row.status},style:{"--color":e.getStatusColor(t.row.status)}}),n("span",{staticClass:"tip"},[e._v(e._s(e.getStatusInfo(t.row.status)))])])]}}])}),n("el-table-column",{attrs:{prop:"type",label:"类型",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-tag",{attrs:{type:"small",effect:"light"}},[e._v(e._s(1===t.row.type?"Interval":"Cron"))])]}}])}),n("el-table-column",{attrs:{prop:"service","show-overflow-tooltip":"",label:"调用服务",width:"350",align:"center"}}),n("el-table-column",{attrs:{prop:"data","show-overflow-tooltip":"",label:"执行参数",width:"450",align:"center"}}),n("el-table-column",{attrs:{prop:"remark","show-overflow-tooltip":"",label:"备注",width:"250",align:"center"}}),n("el-table-column",{attrs:{label:"操作",width:"150",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"mini",type:"text",disabled:!e.$auth("sys.task.update")},on:{click:function(n){return e.handleEdit(t.row)}}},[e._v("编辑")]),n("warning-confirm-button",{attrs:{closed:e.handleRefresh,disabled:!e.$auth("sys.task.delete")},on:{confirm:function(n){e.handleDelete(t.row,n)}}},[e._v("删除")])]}}])})],1)],1),n("system-schedule-task-form-dialog",{ref:"taskFormDialog",on:{"save-success":e.handleRefresh}})],1)},r=[],o=n("1da1"),s=(n("99af"),n("96cf"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("form-dialog",{ref:"formDialog",scopedSlots:e._u([{key:"slot-type",fn:function(t){var a=t.scope;return[n("el-radio-group",{on:{change:e.handleTaskTypeChange},model:{value:a.type,callback:function(t){e.$set(a,"type",t)},expression:"scope.type"}},[n("el-radio",{attrs:{label:0}},[e._v("Cron")]),n("el-radio",{attrs:{label:1}},[e._v("时间间隔")])],1)]}},{key:"slot-status",fn:function(t){var a=t.scope;return[n("el-radio-group",{model:{value:a.status,callback:function(t){e.$set(a,"status",t)},expression:"scope.status"}},[n("el-radio",{attrs:{label:1}},[e._v("运行")]),n("el-radio",{attrs:{label:0}},[e._v("停止")])],1)]}}])})}),i=[],l=n("501e"),c=n.n(l),u=(n("d9e2"),{name:"SystemScheduleTaskFormDialog",methods:{handleOpen:function(e,t,n){var a=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r,o,s,i,l,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=n.showLoading,o=n.hideLoading,s=n.close,i=n.rebind,-1===e){t.next=15;break}return t.prev=2,r(),t.next=6,a.$api.sys.task.info({id:e});case 6:l=t.sent,c=l.data,i(c),o(),t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](2),s();case 15:case"end":return t.stop()}}),t,null,[[2,12]])})))()},handleSubmit:function(e,t,n){var a=this,r=n.close,o=n.done,s=null;-1===e?s=this.$api.sys.task.add(t):(t.id=e,s=this.$api.sys.task.update(t)),s.then((function(e){a.$emit("save-success"),r()})).catch((function(){o()}))},open:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(!c()(t))throw new Error("task id must be a number");this.$refs.formDialog.open({title:"编辑任务",dialogProps:{top:"10vh"},on:{open:function(n,a){e.handleOpen(t,n,a)},submit:function(n,a){e.handleSubmit(t,n,a)}},items:[{label:"类型",prop:"type",value:0,rules:{required:!0,message:"请选择任务类型",trigger:"blur"},component:"slot-type"},{label:"任务名称",prop:"name",value:"",rules:{required:!0,message:"请输入任务名称",trigger:"blur"},component:{name:"el-input",attrs:{placeholder:"请输入任务名称"}}},{label:"服务路径",prop:"service",value:"",rules:{required:!0,message:"请输入调用服务的路径",trigger:"blur"},component:{name:"el-input",attrs:{placeholder:"请输入调用服务的路径"}}},{label:"任务参数",prop:"data",value:"",component:{name:"el-input",attrs:{placeholder:"请输入任务参数（可不填）"}}},{label:"执行次数",prop:"limit",value:-1,component:{name:"el-input-number",style:{width:"100%"},props:{"controls-position":"right",min:-1}}},{label:"Cron",prop:"cron",value:"",hidden:function(e){var t=e.scope;return 1===t.type},rules:{required:!0,message:"请输入Cron表达式",trigger:"blur"},component:{name:"el-input",attrs:{placeholder:"请输入Cron表达式"}}},{label:"执行间隔",prop:"every",value:6e4,rules:{required:!0,message:"请输入Cron表达式",trigger:"blur"},hidden:function(e){var t=e.scope;return 0===t.type},component:{name:"el-input-number",style:{width:"100%"},props:{"controls-position":"right",min:0}}},{label:"开始日期",prop:"startTime",value:"",hidden:function(e){var t=e.scope;return 1===t.type},component:{name:"el-date-picker",props:{type:"datetime"},style:{width:"100%"},attrs:{placeholder:"请选择开始日期"}}},{label:"结束日期",prop:"endTime",value:"",hidden:function(e){var t=e.scope;return 1===t.type},component:{name:"el-date-picker",props:{type:"datetime"},style:{width:"100%"},attrs:{placeholder:"请选择结束日期"}}},{label:"备注",prop:"remark",value:"",component:{name:"el-input",props:{type:"textarea",rows:2}}},{label:"状态",prop:"status",value:1,component:"slot-status"}]})},handleTaskTypeChange:function(){this.$refs.formDialog&&this.$refs.formDialog.clearValidate()}}}),p=u,d=n("2877"),f=Object(d["a"])(p,s,i,!1,null,null,null),m=f.exports,h=n("fbbc"),b=n("fe2b"),g=n("ab09"),v={name:"SystemScheduleTask",components:{TableLayout:h["a"],STable:g["a"],WarningConfirmButton:b["a"],SystemScheduleTaskFormDialog:m},methods:{getTaskList:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var a,r,o,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=e.page,r=e.limit,n.next=3,t.$api.sys.task.page({page:a,limit:r});case 3:return o=n.sent,s=o.data,n.abrupt("return",s);case 6:case"end":return n.stop()}}),n)})))()},handleRefresh:function(){this.$refs.taskTable.refresh()},handleAdd:function(){this.$refs.taskFormDialog.open()},handleEdit:function(e){this.$refs.taskFormDialog.open(e.id)},handleDelete:function(e,t){var n=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var r,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=t.done,o=t.close,a.prev=1,a.next=4,n.$api.sys.task.delete({id:e.id});case 4:o(),a.next=10;break;case 7:a.prev=7,a.t0=a["catch"](1),r();case 10:case"end":return a.stop()}}),a,null,[[1,7]])})))()},handleOnce:function(e,t){var n=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var r,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=t.done,o=t.close,a.prev=1,a.next=4,n.$api.sys.task.once({id:e.id});case 4:o(),a.next=10;break;case 7:a.prev=7,a.t0=a["catch"](1),r();case 10:case"end":return a.stop()}}),a,null,[[1,7]])})))()},handleStart:function(e,t){var n=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var r,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=t.done,o=t.close,a.prev=1,a.next=4,n.$api.sys.task.start({id:e.id});case 4:o(),a.next=10;break;case 7:a.prev=7,a.t0=a["catch"](1),r();case 10:case"end":return a.stop()}}),a,null,[[1,7]])})))()},handleStop:function(e,t){var n=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var r,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=t.done,o=t.close,a.prev=1,a.next=4,n.$api.sys.task.stop({id:e.id});case 4:o(),a.next=10;break;case 7:a.prev=7,a.t0=a["catch"](1),r();case 10:case"end":return a.stop()}}),a,null,[[1,7]])})))()},getStatusInfo:function(e){switch(e){case 0:return"停止";case 1:return"运行"}},getStatusColor:function(e){switch(e){case 0:return"#d9d9d9";case 1:return"#52c41a"}},parseExecTime:function(e){return e.startTime||e.endTime?!e.startTime&&e.endTime?"无开始时间限制 - ".concat(e.endTime):e.startTime&&!e.endTime?"".concat(e.startTime," - 长期有效"):"".concat(e.startTime," - ").concat(e.endTime):"无时段限制"}}},y=v,w=(n("4ea7"),n("cc9c"),Object(d["a"])(y,a,r,!1,null,"0501e8a4",null));t["default"]=w.exports},cc9c:function(e,t,n){"use strict";n("1e38")},fe2b:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-button",{attrs:{size:e.size,type:e.buttonType,disabled:e.disabled},on:{click:function(t){return t.stopPropagation(),e._handleClick.apply(null,arguments)}}},[e._t("default")],2)},r=[],o={name:"WarningConfirmButton",props:{content:{type:String,default:"此操作无法恢复，是否继续？"},title:{type:String,default:"警告"},confirmButtonText:{type:String,default:"确定"},cancelButtonText:{type:String,default:"取消"},iconType:{type:String,default:"warning",validator:function(e){return-1!==["success","info","warning","error"].indexOf(e)}},size:{type:String,default:"mini"},buttonType:{type:String,default:"text"},disabled:{type:Boolean,default:!1},closed:{type:Function,default:function(){return function(){}}},cancel:{type:Function,default:function(){return function(){}}}},data:function(){return{loading:!1}},methods:{_handleClick:function(){var e=this;this.$confirm(this.content,this.title,{confirmButtonText:this.confirmButtonText,cancelButtonText:this.cancelButtonText,type:this.iconType,beforeClose:function(t,n,a){"confirm"===t?(n.confirmButtonLoading=!0,e.$emit("confirm",{close:function(){n.confirmButtonLoading=!1,a()},done:function(){n.confirmButtonLoading=!1}})):(n.confirmButtonLoading=!1,a())}}).then((function(t){e.closed()})).catch((function(t){e.cancel()}))}}},s=o,i=n("2877"),l=Object(i["a"])(s,a,r,!1,null,null,null);t["a"]=l.exports}}]);